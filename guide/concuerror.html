<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Erlang.mk User Guide</title>
<style type="text/css"><!--
body{background:white;color:black;font-family:"Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;justify-content:center;margin:0 auto;padding:0;width:600px}
header {align-items:center;display:flex;justify-content:center}
header nav.left{text-align:right;width:150px}
header nav.right{text-align:left;width:150px}
header nav a{display:block;margin:1.5em 1em}
main{margin-top:2em;text-align:justify}
main h2, main h3{margin-top:2em}
main h1, main div.chapter>div.titlepage h2{font-size:2em;margin-top:.67em}
a{color:#d9230f;text-decoration:none}
a:hover{text-decoration:underline}
a.xref{display:none}
h1, h2, h3{font-weight:normal}
div.navfooter{margin-bottom:1em}
--></style>
</head>
<body>
<header>
	<nav class="left">
		<a href="index.html">User guide</a>
		<a href="getting_started.html">Tutorials</a>
	</nav>
	<a href="/" class="logo"><img src="../res/logo-small.png" alt="Erlang.mk" title="Erlang.mk: A build tool for Erlang that just works" height="200" width="206"/></a>
	<nav class="right">
		<a href="https://github.com/ninenines/erlang.mk/tree/master/index">470+ packages</a>
		<a href="https://github.com/ninenines/erlang.mk/issues">Issues?</a>
	</nav>
</header>
<main>

<div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="dialyzer.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="xref.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="concuerror"></a>Chapter 27. Concuerror</h2></div></div></div><p><a class="ulink" href="https://concuerror.com/" target="_top">Concuerror</a> is a stateless model
checking tool for Erlang programs. It can be used to detect
and debug concurrency errors, such as deadlocks and errors
due to race conditions. The key property of such errors is
that they only occur on few, specific schedulings of the
program. Moreover, unlike tools based on randomisation,
Concuerror can verify the absence of such errors, because
it tests the program systematically.</p><p>Erlang.mk provides a wrapper around Concuerror.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_configuration_9"></a>27.1. Configuration</h2></div></div></div><p>The <code class="literal">CONCUERROR_TESTS</code> variable must be defined in order to
use Concuerror. It lists the Concuerror test cases. There
is currently no way to detect test cases automatically. The
tests must be listed as <code class="literal">module:function</code> separated by
whitespace. For example:</p><pre class="programlisting">CONCUERROR_TESTS = ranch_concuerror:start_stop ranch_concuerror:info</pre><p>Concuerror will output some information directly on the
screen when run, but errors will only be written to a file.
This is because the error output can be very large. By
default Erlang.mk instructs Concuerror to save log files
in the <span class="emphasis"><em>logs/</em></span> directory (shared with Common Test). This
can be changed by setting <code class="literal">CONCUERROR_LOGS_DIR</code>:</p><pre class="programlisting">CONCUERROR_LOGS_DIR = $(CURDIR)/path/to/logs</pre><p>Concuerror options can be specified using the
<code class="literal">CONCUERROR_OPTS</code> variable:</p><pre class="programlisting">CONCUERROR_OPTS = -k</pre><p>Note that options may also be specified on a per-module
basis using the <code class="literal">-concuerror_options([]).</code> attribute.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_writing_tests_3"></a>27.2. Writing tests</h2></div></div></div><p>Concuerror tests are a simple 0-arity function that must
be exported. For example:</p><pre class="programlisting">-export([info/0]).

info() →
    %% Ensure we can call ranch:info/1 after starting a listener.
    SupPid = do_start(),
    {ok, _} = ranch:start_listener(?FUNCTION_NAME,
        ranch_erlang_transport, #{
            num_acceptors ⇒ 1
        },
        echo_protocol, []),
    #{} = ranch:info(?FUNCTION_NAME),
    do_stop(SupPid).</pre><p>Do not forget to add the function to <code class="literal">CONCUERROR_TESTS</code>
as well.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_usage_7"></a>27.3. Usage</h2></div></div></div><p>To run Concuerror:</p><pre class="programlisting">$ make concuerror</pre><p>Erlang.mk will create an index of all the test logs in
the <span class="emphasis"><em>$(CONCUERROR_LOGS_DIR)/concuerror.html</em></span> file.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dialyzer.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="tests.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="xref.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div>
</main>
</body>
</html>
